<?php
$site = $site ?? null;
$siteTitle = $site ? $site->title() : 'Site';
$escape = $this->plugin('escapeHtml');
$navPages = $site->publicNav()->getPages();
$topLevelLabels = ['Home', 'All Funds', 'About', 'Contact'];
?>

<header class="site-header">
  <div class="header-inner">

    <!-- Site Logo -->
    <a href="<?= $site->url(); ?>" class="site-logo" aria-label="<?= $escape($siteTitle); ?>">
      <?php if ($this->themeSetting('logo')): ?>
        <img src="<?= $this->themeSettingAssetUrl('logo'); ?>" alt="<?= $escape($siteTitle); ?>">
      <?php else: ?>
        <span class="text-logo"><?= $escape($siteTitle); ?></span>
      <?php endif; ?>
    </a>

    <!-- Navigation -->
    <nav class="main-nav" aria-label="Main Navigation">
      <ul class="nav-links">
        <?php foreach ($navPages as $page):
          $label = $escape($page->getLabel());
          $isActive = $page->isActive() ? 'active' : '';

          if (!in_array($label, $topLevelLabels)) continue;

          if ($label === 'About' && $page->hasPages()):
        ?>
          <li class="nav-item nav-dropdown">
            <a href="<?= $escape($page->getHref()) ?>" class="nav-link <?= $isActive ?>">
              <?= $label ?>
            </a>
            <ul class="sub-menu">
              <?php foreach ($page->getPages() as $subPage): ?>
                <li><a href="<?= $escape($subPage->getHref()) ?>"><?= $escape($subPage->getLabel()) ?></a></li>
              <?php endforeach; ?>
            </ul>
          </li>
        <?php else: ?>
          <li class="nav-item">
            <a href="<?= $escape($page->getHref()) ?>" class="<?= $isActive ?>">
              <?= $label ?>
            </a>
          </li>
        <?php endif; endforeach; ?>
      </ul>
    </nav>
    <!-- Search -->
    <div class="site-search">
      <?= $this->partial('common/search-form'); ?>
    </div>

    <!-- Mobile Toggle -->
    <button class="mobile-nav-toggle" aria-label="<?= $this->translate('Toggle navigation'); ?>">
      â˜°
    </button>

  </div>
</header>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.querySelector(".mobile-nav-toggle");
    const nav = document.querySelector(".main-nav");
    toggle?.addEventListener("click", () => {
      nav.classList.toggle("mobile-nav-open");
    });

    const dropdown = document.querySelector('.nav-dropdown');
    const dropdownLink = dropdown?.querySelector('.nav-link');
    dropdownLink?.addEventListener('click', function (e) {
      e.preventDefault();
      dropdown.classList.toggle('open');
    });
  });
</script>
